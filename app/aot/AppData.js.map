{"version":3,"sources":["../src/AppData.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,2CAAqC;AACrC,4CAA4C;AAE5C,sCAKO;AAEO;IAeZ,iBAAmB,UAAqB,EAAS,QAAiB;QAAlE,iBAQC;QARkB,eAAU,GAAV,UAAU,CAAW;QAAS,aAAQ,GAAR,QAAQ,CAAS;QAdlE,gBAAW,GAAW,IAAI,CAAA;QAC1B,gBAAW,GAAW,IAAI,CAAA;QAC1B,WAAM,GAAW,KAAK,CAAA;QAEtB,SAAI,GAAG,EAAE,CAAA;QAGT,cAAS,GAAG,EAAE,CAAA;QAEL,SAAI,GAAG,EAAC,MAAM,EAAC,EAAE,EAAE,KAAK,EAAC,EAAE,EAAC,CAAA;QAC3B,eAAU,GAAG,IAAI,mBAAY,EAAE,CAAA;QAChC,eAAU,GAAG,2BAA2B,CAAA;QACvC,qBAAgB,GAAG,IAAI,mBAAY,EAAE,CAAA;QAG7C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC;aACtC,IAAI,CAAC,UAAA,IAAI;YACR,KAAI,CAAC,IAAI,GAAG,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,IAAI,GAAG,EAAC,MAAM,EAAC,EAAE,EAAC,CAAA;YACvD,KAAI,CAAC,aAAa,CAAE,KAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAE,CAAA;QAC3C,CAAC,CAAC;aACD,IAAI,CAAE,cAAI,OAAA,KAAI,CAAC,gBAAgB,EAAE,EAAvB,CAAuB,CAAE;aACnC,KAAK,CAAC,UAAA,CAAC,IAAE,OAAA,KAAI,CAAC,KAAK,GAAC,CAAC,EAAZ,CAAY,CAAC,CAAA;IACzB,CAAC;IAED,kCAAgB,GAAhB;QAAA,iBAGC;QAFC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,WAAW,CAAC;aACtC,IAAI,CAAE,UAAA,SAAS,IAAE,OAAA,KAAI,CAAC,SAAS,GAAC,SAAS,EAAxB,CAAwB,CAAE,CAAA;IAC9C,CAAC;IAED,6BAAW,GAAX,UAAY,IAAI;QAAhB,iBAiBC;QAhBC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAC/B,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAA;QAE/B,EAAE,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA,CAAC;YACZ,OAAO,GAAG,OAAO,CAAC,IAAI,CAAE,cAAI,OAAA,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAhC,CAAgC,CAAE,CAAA;QAChE,CAAC;QAED,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC;YAClB,IAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAA;YAC5C,KAAI,CAAC,UAAU,GAAG,MAAM,CAAA;YACxB,KAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAI,CAAC,UAAU,CAAC,CAAA;YAC3C,MAAM,CAAC,MAAM,CAAA;QACf,CAAC,CAAC;aACD,IAAI,CAAE,UAAA,MAAM,IAAE,OAAA,KAAI,CAAC,WAAW,CAAE,MAAM,CAAE,EAA1B,CAA0B,CAAE;aAC1C,KAAK,CAAC,UAAA,CAAC,IAAE,OAAA,KAAI,CAAC,KAAK,GAAC,CAAC,EAAZ,CAAY,CAAC,CAAA;IACzB,CAAC;IAED,+BAAa,GAAb,UAAc,MAAM;QAClB,IAAI,CAAC,UAAU,GAAG,MAAM,CAAA;QACxB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC3C,IAAI,CAAC,eAAe,CAAE,IAAI,CAAC,UAAU,CAAE,CAAA;IACzC,CAAC;IAED,iCAAe,GAAf,UAAgB,MAAO;QACrB,IAAG,CAAC;YACF,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAE,MAAM,IAAE,IAAI,CAAC,UAAU,CAAE,CAAA;YACjD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAE/B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAA;YACxB,IAAI,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACjD,CAAC;QAAA,KAAK,CAAA,CAAC,CAAC,CAAC,CAAA,CAAC;YACR,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;QACzB,CAAC;IACH,CAAC;IAED,8BAAY,GAAZ,UAAa,MAAO;QAClB,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAA;QAC5B,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,CAAA;IAC3B,CAAC;IAED,6BAAW,GAAX,UAAY,MAAO;QAAnB,iBAeC;QAdC,EAAE,CAAA,CAAC,IAAI,CAAC,MAAM,CAAC;YAAA,MAAM,CAAA;QAErB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;QAElB,UAAU,CAAC;YACT,MAAM,GAAG,MAAM,IAAE,KAAI,CAAC,UAAU,CAAA;YAEhC,MAAM,CAAC,MAAM,CAAC,KAAI,CAAC,IAAI,EAAE,EAAC,MAAM,EAAC,MAAM,EAAC,CAAC,CAAA;YAEzC,KAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAC,KAAI,CAAC,IAAI,CAAC;iBACpC,KAAK,CAAE,UAAA,CAAC,IAAE,OAAA,KAAI,CAAC,KAAK,GAAC,KAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAA/B,CAA+B,CAAE;iBAC3C,IAAI,CAAE,cAAI,OAAA,KAAI,CAAC,MAAM,GAAC,KAAK,EAAjB,CAAiB,CAAE;iBAC7B,IAAI,CAAE,cAAI,OAAA,KAAI,CAAC,UAAU,GAAC,IAAI,CAAC,GAAG,EAAE,EAA1B,CAA0B,CAAE,CAAA;QACzC,CAAC,EAAE,IAAI,CAAC,CAAA;IACV,CAAC;IAED,4BAAU,GAAV,UAAW,IAAI,EAAE,IAA0B;QAA3C,iBAUC;QATC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,WAAW,CAAC;aACtC,IAAI,CAAC,UAAA,SAAS;YACb,SAAS,GAAG,SAAS,IAAI,EAAE,CAAA;YAC3B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;YAChB,SAAS,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAA;YAC/C,MAAM,CAAC,KAAI,CAAC,SAAS,GAAG,SAAS,CAAA;QACnC,CAAC,CAAC;aACD,IAAI,CAAE,UAAA,SAAS,IAAE,OAAA,KAAI,CAAC,UAAU,CAAC,GAAG,CAAC,WAAW,EAAC,SAAS,CAAC,EAA1C,CAA0C,CAAE;aAC7D,KAAK,CAAC,UAAA,CAAC,IAAE,OAAA,KAAI,CAAC,KAAK,GAAC,CAAC,EAAZ,CAAY,CAAC,CAAA;IACzB,CAAC;IAED,6BAAW,GAAX,UAAY,EAAE;QACZ,MAAM,CAAC,EAAE,CAAC,MAAM,IAAI,EAAE,CAAC,KAAK,GAAG,IAAI,GAAG,KAAK,CAAA;IAC7C,CAAC;IA7FQ;QAAR,YAAK,EAAE;;yCAA6B;IAC3B;QAAT,aAAM,EAAE;;+CAAgC;IAChC;QAAR,YAAK,EAAE;;+CAAyC;IACvC;QAAT,aAAM,EAAE;;qDAAsC;IAbtB,OAAO;QAAjC,iBAAU,EAAE;yCAemB,wBAAU,EAAkB,sBAAQ;OAfzC,OAAO,CAwGjC;IAAD,cAAC;CAxGa,AAwGb,IAAA;AAxG0B,0BAAO","file":"AppData.js","sourceRoot":"","sourcesContent":["import { AckOffline, ErrorLog } from \"ack-angular\"\n//import * as ack from \"ack-x/index-browser\"\n\nimport {\n  Injectable,\n  EventEmitter,\n  Input,\n  Output\n} from '@angular/core'\n\n@Injectable() export class AppData{\n  invalidRjon:boolean = true\n  invalidJson:boolean = true\n  saving:boolean = false\n  error\n  data = {}\n  load\n  lastSaveAt\n  rjonSaves = {}\n\n  @Input() rjon = {routes:[], hosts:[]}\n  @Output() rjonChange = new EventEmitter()\n  @Input() rjonString = '{\"routes\":[], \"hosts\":[]}'\n  @Output() rjonStringChange = new EventEmitter()\n\n  constructor(public AckOffline:AckOffline, public ErrorLog:ErrorLog){\n    this.load = this.AckOffline.get('rjon')\n    .then(rjon=>{\n      this.data = rjon && rjon['string'] ? rjon : {string:''}\n      this.setRjonString( this.data['string'] )\n    })\n    .then( ()=>this.loadOfflineSaves() )\n    .catch(e=>this.error=e)\n  }\n\n  loadOfflineSaves(){\n    return this.AckOffline.get('rjonSaves')\n    .then( rjonSaves=>this.rjonSaves=rjonSaves )\n  }\n\n  setSaveRjon(rjon){\n    this.rjon = rjon\n    this.rjonChange.emit(this.rjon)\n    let promise = Promise.resolve()\n\n    if(rjon.name){\n      promise = promise.then( ()=>this.saveRjonAs(rjon.name, rjon) )\n    }\n\n    return promise.then(()=>{\n      const string = JSON.stringify(rjon, null, 2)\n      this.rjonString = string\n      this.rjonStringChange.emit(this.rjonString)\n      return string\n    })\n    .then( string=>this.saveOffline( string ) )\n    .catch(e=>this.error=e)\n  }\n\n  setRjonString(string){\n    this.rjonString = string\n    this.rjonStringChange.emit(this.rjonString)\n    this.parseRjonString( this.rjonString )\n  }\n\n  parseRjonString(string?){\n    try{\n      this.rjon = JSON.parse( string||this.rjonString )\n      this.rjonChange.emit(this.rjon)\n      \n      this.invalidJson = false\n      this.invalidRjon = !this.isValidRjon(this.rjon)\n    }catch(e){\n      this.invalidJson = true\n    }\n  }\n\n  parseAndSave(string?){\n    this.parseRjonString(string)\n    return this.saveOffline()\n  }\n\n  saveOffline(string?){\n    if(this.saving)return\n\n    this.saving = true\n    \n    setTimeout(()=>{\n      string = string||this.rjonString\n\n      Object.assign(this.data, {string:string})\n\n      this.AckOffline.set('rjon',this.data)\n      .catch( e=>this.error=this.ErrorLog.add(e) )\n      .then( ()=>this.saving=false )\n      .then( ()=>this.lastSaveAt=Date.now() )\n    }, 1000)\n  }\n\n  saveRjonAs(name, rjon:{name, routes, hosts}){\n    return this.AckOffline.get('rjonSaves')\n    .then(rjonSaves=>{\n      rjonSaves = rjonSaves || {}\n      rjon.name = name\n      rjonSaves[name] = JSON.stringify(rjon, null, 2)\n      return this.rjonSaves = rjonSaves\n    })\n    .then( rjonSaves=>this.AckOffline.set('rjonSaves',rjonSaves) )\n    .catch(e=>this.error=e)\n  }\n\n  isValidRjon(ob){\n    return ob.routes && ob.hosts ? true : false\n  }\n}"]}